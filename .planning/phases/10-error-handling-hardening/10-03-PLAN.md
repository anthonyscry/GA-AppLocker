---
phase: 10-error-handling-hardening
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - GA-AppLocker/Modules/GA-AppLocker.Scanning/GA-AppLocker.Scanning.psm1
  - GA-AppLocker/Modules/GA-AppLocker.Setup/GA-AppLocker.Setup.psm1
  - GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Write-AppLockerLog.ps1
  - GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Resolve-GroupSid.ps1
  - GA-AppLocker/Modules/GA-AppLocker.Setup/Functions/Get-SetupStatus.ps1
  - GA-AppLocker/Modules/GA-AppLocker.Scanning/Functions/Get-LocalArtifacts.ps1
  - GA-AppLocker/Modules/GA-AppLocker.Scanning/Functions/Get-AppLockerEventLogs.ps1
  - GA-AppLocker/Modules/GA-AppLocker.Discovery/Functions/Test-MachineConnectivity.ps1
  - GA-AppLocker/Modules/GA-AppLocker.Rules/Functions/Import-RulesFromXml.ps1
autonomous: true
requirements:
  - ERR-03

must_haves:
  truths:
    - "Every catch block in backend Module files contains a Write-AppLockerLog call or documented intentional suppression comment"
    - "No empty catch blocks remain in any Module .ps1 or .psm1 file"
    - "Error log messages include the function/module name and operation context"
  artifacts:
    - path: "GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Resolve-GroupSid.ps1"
      provides: "5 empty catches replaced with contextual logging"
    - path: "GA-AppLocker/Modules/GA-AppLocker.Discovery/Functions/Test-MachineConnectivity.ps1"
      provides: "6 empty catches replaced with contextual logging"
    - path: "GA-AppLocker/Modules/GA-AppLocker.Setup/Functions/Get-SetupStatus.ps1"
      provides: "4 empty catches replaced with contextual logging"
    - path: "GA-AppLocker/Modules/GA-AppLocker.Scanning/GA-AppLocker.Scanning.psm1"
      provides: "3 empty catches replaced with contextual logging"
  key_links:
    - from: "Modules/*/Functions/*.ps1 catch blocks"
      to: "Write-AppLockerLog"
      via: "catch { Write-AppLockerLog -Message ... -Level DEBUG }"
      pattern: "catch\\s*\\{\\s*Write-AppLockerLog"
---

<objective>
Replace all 25 empty catch blocks across 9 backend Module files with contextual Write-AppLockerLog calls.

Purpose: Backend modules handle data operations (scanning, discovery, setup, rule import, SID resolution). Silent catch blocks here hide real failures — connectivity tests that falsely report success, SID resolution that silently returns unresolved, setup status that reports incomplete when it actually errored. These are the hardest bugs to diagnose because the data looks wrong but no error is logged.

Output: 9 Module files updated with contextual error logging in every catch block.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Resolve-GroupSid.ps1
@GA-AppLocker/Modules/GA-AppLocker.Discovery/Functions/Test-MachineConnectivity.ps1
@GA-AppLocker/Modules/GA-AppLocker.Setup/Functions/Get-SetupStatus.ps1
@GA-AppLocker/Modules/GA-AppLocker.Scanning/GA-AppLocker.Scanning.psm1
@GA-AppLocker/Modules/GA-AppLocker.Scanning/Functions/Get-LocalArtifacts.ps1
@GA-AppLocker/Modules/GA-AppLocker.Scanning/Functions/Get-AppLockerEventLogs.ps1
@GA-AppLocker/Modules/GA-AppLocker.Rules/Functions/Import-RulesFromXml.ps1
@GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Write-AppLockerLog.ps1
@GA-AppLocker/Modules/GA-AppLocker.Setup/GA-AppLocker.Setup.psm1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace empty catches in high-importance module files (Resolve-GroupSid, Test-MachineConnectivity, Get-SetupStatus)</name>
  <files>
    GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Resolve-GroupSid.ps1
    GA-AppLocker/Modules/GA-AppLocker.Discovery/Functions/Test-MachineConnectivity.ps1
    GA-AppLocker/Modules/GA-AppLocker.Setup/Functions/Get-SetupStatus.ps1
  </files>
  <action>
For each empty catch block (`catch { }`) in these 3 files (total ~15 instances):

1. Read the surrounding try block to understand what operation is being attempted
2. Replace the empty catch body with a Write-AppLockerLog call:

```powershell
catch {
    Write-AppLockerLog -Message "[FunctionName] Failed to <operation>: $_" -Level DEBUG
}
```

Function name prefix rules — use the actual function name in brackets:
- Resolve-GroupSid.ps1: `[Resolve-GroupSid]` — these are SID resolution fallback chains (NTAccount, ADSI, LDAP). Each catch represents a fallback step that is EXPECTED to fail in some environments. Use **DEBUG** level since the fallback chain is by design.
- Test-MachineConnectivity.ps1: `[Test-MachineConnectivity]` — ping/WinRM test failures. Use **DEBUG** for individual machine ping failures (expected for offline machines). Use **WARN** only if an unexpected exception type occurs.
- Get-SetupStatus.ps1: `[Get-SetupStatus]` — GPO and module availability checks. Use **DEBUG** since these are probing operations that legitimately fail when RSAT/GroupPolicy is missing.

CRITICAL for Resolve-GroupSid.ps1: This function has a multi-method SID resolution fallback chain. Empty catches are how it falls through to the next method. The logging MUST NOT change this behavior — just add the log line, do not add `throw`, `return`, or `continue`.

CRITICAL for Write-AppLockerLog.ps1: If this file has an empty catch, it is likely a guard against recursive logging failure. Add a comment `# Intentional: prevent recursive logging failure` instead of a Write-AppLockerLog call (which would cause infinite recursion).

Do NOT change any logic, control flow, or return values.
  </action>
  <verify>
Run: `grep -cP 'catch\s*\{?\s*\}' GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Resolve-GroupSid.ps1 GA-AppLocker/Modules/GA-AppLocker.Discovery/Functions/Test-MachineConnectivity.ps1 GA-AppLocker/Modules/GA-AppLocker.Setup/Functions/Get-SetupStatus.ps1`
Each file should return 0.
  </verify>
  <done>All 15 empty catch blocks in Resolve-GroupSid (5), Test-MachineConnectivity (6), and Get-SetupStatus (4) contain contextual logging or intentional-suppression comments.</done>
</task>

<task type="auto">
  <name>Task 2: Replace empty catches in remaining module files (Scanning psm1, Get-LocalArtifacts, Get-AppLockerEventLogs, Import-RulesFromXml, Setup psm1, Write-AppLockerLog)</name>
  <files>
    GA-AppLocker/Modules/GA-AppLocker.Scanning/GA-AppLocker.Scanning.psm1
    GA-AppLocker/Modules/GA-AppLocker.Setup/GA-AppLocker.Setup.psm1
    GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Write-AppLockerLog.ps1
    GA-AppLocker/Modules/GA-AppLocker.Scanning/Functions/Get-LocalArtifacts.ps1
    GA-AppLocker/Modules/GA-AppLocker.Scanning/Functions/Get-AppLockerEventLogs.ps1
    GA-AppLocker/Modules/GA-AppLocker.Rules/Functions/Import-RulesFromXml.ps1
  </files>
  <action>
For each empty catch block (`catch { }`) in these 6 files (total ~10 instances):

Apply the same pattern:

```powershell
catch {
    Write-AppLockerLog -Message "[ModuleName] Failed to <operation>: $_" -Level DEBUG
}
```

Prefix rules:
- GA-AppLocker.Scanning.psm1: `[Scanning]`
- GA-AppLocker.Setup.psm1: `[Setup]`
- Get-LocalArtifacts.ps1: `[Get-LocalArtifacts]`
- Get-AppLockerEventLogs.ps1: `[Get-AppLockerEventLogs]`
- Import-RulesFromXml.ps1: `[Import-RulesFromXml]`

SPECIAL CASE for Write-AppLockerLog.ps1: If the catch block is inside the logging function itself, do NOT call Write-AppLockerLog (infinite recursion). Instead add: `# Intentional: prevent recursive logging failure`

SPECIAL CASE for .psm1 files: These are module loaders that dot-source function files. Empty catches around dot-source calls should log at **WARN** level since a failed dot-source means exported functions are silently missing.

Level selection for function files:
- Get-LocalArtifacts.ps1: **DEBUG** for individual file processing failures (expected for locked/system files)
- Get-AppLockerEventLogs.ps1: **DEBUG** for event log access failures (expected on machines without AppLocker)
- Import-RulesFromXml.ps1: **WARN** for XML parsing failures (data loss risk)

Do NOT change any logic, control flow, or return values.
  </action>
  <verify>
Run: `grep -rcP 'catch\s*\{?\s*\}' GA-AppLocker/Modules/` should return 0 total.

Confirm no remaining empty catches: `grep -rlP 'catch\s*\{?\s*\}' GA-AppLocker/Modules/` should return no files.
  </verify>
  <done>All 25 empty catch blocks across all 9 backend Module files are replaced with contextual logging or documented intentional-suppression comments. Zero empty catches remain in Modules/.</done>
</task>

</tasks>

<verification>
1. `grep -rP 'catch\s*\{?\s*\}' GA-AppLocker/Modules/` returns no matches
2. `grep -c 'Write-AppLockerLog' GA-AppLocker/Modules/GA-AppLocker.Core/Functions/Resolve-GroupSid.ps1` shows increased count
3. Spot-check Resolve-GroupSid.ps1 to confirm fallback chain logic is unchanged (only logging added)
4. Spot-check Write-AppLockerLog.ps1 to confirm no recursive logging call was added
</verification>

<success_criteria>
- Zero empty catch blocks remain in any Module .ps1 or .psm1 file
- Resolve-GroupSid fallback chain behavior is unchanged (just logging added)
- Write-AppLockerLog.ps1 has no self-referencing log call (intentional comment instead)
- No logic, control flow, or return values were changed
</success_criteria>

<output>
After completion, create `.planning/phases/10-error-handling-hardening/10-03-SUMMARY.md`
</output>
